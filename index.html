<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf RPG Pro</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #0a0a0a; overflow: hidden; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        #game-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .stats-card { position: absolute; top: 20px; left: 20px; background: rgba(0, 0, 0, 0.85); border-left: 4px solid #00ffcc; padding: 15px; border-radius: 0 10px 10px 0; pointer-events: auto; box-shadow: 0 4px 15px rgba(0,0,0,0.5); }
        .lvl-text { color: #00ffcc; font-weight: bold; font-size: 18px; margin-bottom: 5px; }
        .exp-container { width: 150px; height: 8px; background: #333; border-radius: 4px; overflow: hidden; }
        #exp-bar { height: 100%; background: linear-gradient(90deg, #00ffcc, #0088ff); width: 0%; transition: width 0.4s ease; }
        #altar-btn { position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%); background: #ffd700; border: none; padding: 15px 40px; border-radius: 25px; font-weight: bold; font-size: 16px; cursor: pointer; pointer-events: auto; box-shadow: 0 0 20px rgba(255, 215, 0, 0.4); }
    </style>
</head>
<body>

<div id="game-ui">
    <div class="stats-card">
        <div class="lvl-text" id="lvl-label">WOLF ALFA LVL 1</div>
        <div style="color: #ffd700; font-size: 12px; margin-bottom: 8px;" id="stats-label">MAPA: 1 | ORBES: 0</div>
        <div class="exp-container"><div id="exp-bar"></div></div>
    </div>
    <button id="altar-btn" onclick="openAltar()">ALTAR SAGRADO</button>
</div>

<script>
// Forzamos versi贸n nueva para limpiar cach茅
const VERSION = "v15_PRO_BODY";
let gameState = JSON.parse(localStorage.getItem(VERSION)) || { level: 1, exp: 0, orbes: 0, mapa: 1, color: 0xffffff };

const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    physics: { default: 'arcade', arcade: { debug: false } },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let wolf, preys, grass;

function preload() {
    // Usamos assets de alta calidad y cuerpo completo
    this.load.image('field', 'https://labs.phaser.io/assets/textures/tileset-grass.png');
    this.load.image('wolf_body', 'https://img.icons8.com/color/144/wolf.png'); 
    this.load.image('prey_animal', 'https://img.icons8.com/color/96/deer.png');
}

function create() {
    // Fondo de bosque (Adios rejilla verde)
    grass = this.add.tileSprite(0, 0, 4000, 4000, 'field').setOrigin(0).setAlpha(0.4);
    this.cameras.main.setBounds(0, 0, 3000, 3000);
    this.physics.world.setBounds(0, 0, 3000, 3000);

    // Lobo: Cuerpo completo con rotaci贸n suavizada
    wolf = this.physics.add.sprite(1500, 1500, 'wolf_body');
    wolf.setOrigin(0.5, 0.5);
    wolf.setScale(0.85);
    wolf.setCollideWorldBounds(true);
    wolf.setTint(gameState.color);

    this.cameras.main.startFollow(wolf, true, 0.1, 0.1);

    // Grupo de animales para cazar
    preys = this.physics.add.group();
    for(let i=0; i<15; i++) spawnPrey(this);

    // Mec谩nica de caza profesional
    this.physics.add.overlap(wolf, preys, (w, prey) => {
        prey.destroy();
        this.cameras.main.shake(100, 0.01);
        
        gameState.exp += 35;
        if(gameState.exp >= 100) {
            gameState.level++;
            gameState.exp = 0;
            gameState.mapa = Math.floor(gameState.level/5) + 1;
            gameState.color = Phaser.Display.Color.RandomRGB().color;
            wolf.setTint(gameState.color);
        }

        // TUS REGLAS: Orbes a nivel 20
        if(gameState.level >= 20 || gameState.mapa >= 4) {
            if(Math.random() < 0.2) gameState.orbes++;
        }

        updateUI();
        spawnPrey(this);
    }, null, this);

    updateUI();
}

function update() {
    if (this.input.activePointer.isDown) {
        this.physics.moveToObject(wolf, this.input.activePointer, 300);
        
        // Rotaci贸n natural: El cuerpo se inclina hacia donde corre
        let targetAngle = Phaser.Math.Angle.Between(wolf.x, wolf.y, this.input.activePointer.worldX, this.input.activePointer.worldY);
        wolf.rotation = Phaser.Math.Angle.RotateTo(wolf.rotation, targetAngle + 1.5, 0.15);
        
        // Animaci贸n de escala (simula correr)
        wolf.setScale(0.85 + Math.sin(this.time.now / 80) * 0.04);
    } else {
        wolf.body.setVelocity(0);
        wolf.setScale(0.85);
    }
}

function spawnPrey(scene) {
    let x = Phaser.Math.Between(100, 2900);
    let y = Phaser.Math.Between(100, 2900);
    let p = scene.physics.add.sprite(x, y, 'prey_animal');
    p.setScale(0.6);
}

function updateUI() {
    localStorage.setItem(VERSION, JSON.stringify(gameState));
    document.getElementById('lvl-label').innerText = `WOLF ALFA LVL ${gameState.level}`;
    document.getElementById('stats-label').innerText = `MAPA: ${gameState.mapa} | ORBES: ${gameState.orbes}`;
    document.getElementById('exp-bar').style.width = gameState.exp + '%';
}

function openAltar() {
    alert(` ALTAR SAGRADO\n\nOrbes: ${gameState.orbes}\n\n- 10 Orbes: Deseo pico\n- 60 Orbes: Deseo Legendario\n\n(Debes ser Nivel 20 para recolectar orbes)`);
}
</script>
</body>
</html>
