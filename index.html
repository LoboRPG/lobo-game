<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf RPG Telegram</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #0b1a07; font-family: 'Segoe UI', sans-serif; }
        #hud { position: fixed; top: 10px; left: 10px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 8px; border-left: 4px solid #2ecc71; z-index: 10; pointer-events: none; }
        #mission { position: fixed; bottom: 130px; left: 50%; transform: translateX(-50%); color: #fff; background: rgba(0,0,0,0.5); padding: 8px 20px; border-radius: 20px; font-size: 14px; z-index: 10; }
        #controls { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: space-around; z-index: 20; }
        .btn-circle { width: 80px; height: 80px; background: rgba(255,255,255,0.1); border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-size: 30px; touch-action: none; }
    </style>
</head>
<body>
    <div id="hud">
        üê∫ <b>ALFA RPG</b><br>
        Nivel: <span id="lv">1</span> | Mapa: <span id="map">1</span><br>
        <span id="orb-display" style="color:#ffd700; display:none;">‚ú® Orbes: <span id="orbes">0</span>/60</span>
    </div>
    <div id="mission">Misi√≥n: Caza 3 animales para subir de nivel</div>

    <div id="controls">
        <div class="btn-circle" id="joy">üïπÔ∏è</div>
        <div class="btn-circle" id="atk" style="background: #c0392b;">‚öîÔ∏è</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        let scene, camera, renderer, wolf, joystick = {x:0, y:0}, entities = [];
        let data = { lv: 1, xp: 0, orbes: 0, mapa: 1, hunted: 0 };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x132611); // Bosque profundo
            scene.fog = new THREE.Fog(0x132611, 10, 50);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 10);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            scene.add(new THREE.AmbientLight(0xffffff, 0.8));
            const sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(5, 10, 5);
            scene.add(sun);

            const ground = new THREE.Mesh(new THREE.PlaneGeometry(200, 200), new THREE.MeshStandardMaterial({color: 0x1a2e15}));
            ground.rotation.x = -Math.PI/2;
            scene.add(ground);

            // MODELO DE LOBO (Cuerpo avanzado para que no sea solo un bloque)
            wolf = new THREE.Group();
            const mat = new THREE.MeshStandardMaterial({color: 0x444444});
            const body = new THREE.Mesh(new THREE.CapsuleGeometry(0.4, 1.2, 4, 8), mat);
            body.rotation.x = Math.PI/2;
            const head = new THREE.Mesh(new THREE.SphereGeometry(0.4, 16, 16), mat);
            head.position.set(0, 0.4, 0.8);
            wolf.add(body, head);
            scene.add(wolf);

            spawnPrey();
            animate();
        }

        function spawnPrey() {
            const geo = new THREE.SphereGeometry(0.5, 8, 8);
            for(let i=0; i<8; i++) {
                const p = new THREE.Mesh(geo, new THREE.MeshStandardMaterial({color: 0x8b4513}));
                p.position.set(Math.random()*40-20, 0.5, Math.random()*40-20);
                scene.add(p);
                entities.push(p);
            }
        }

        function updateGame() {
            // Regla de Orbes: Aparecen a nivel 20 o mapa 4
            if(data.lv >= 20 || data.mapa >= 4) {
                document.getElementById('orb-display').style.display = 'inline';
                if(Math.random() < 0.4) { // Probabilidad media
                    data.orbes++;
                    document.getElementById('orbes').innerText = data.orbes;
                    if(data.orbes === 10) tg.showAlert("¬°CONSEGUIDO! Objeto √âpico listo");
                    if(data.orbes === 60) tg.showAlert("¬°LEYENDA! Objeto Legendario listo");
                }
            }
            
            // Misiones por nivel
            if(data.lv < 5) document.getElementById('mission').innerText = "Misi√≥n: Caza presas peque√±as";
            else if(data.lv >= 20) document.getElementById('mission').innerText = "Misi√≥n: Busca los Orbes Sagrados";
        }

        // Joystick y Ataque
        document.getElementById('atk').addEventListener('touchstart', () => {
            entities.forEach((p, i) => {
                if(wolf.position.distanceTo(p.position) < 3) {
                    scene.remove(p);
                    entities.splice(i, 1);
                    data.xp += 40;
                    updateGame();
                    if(data.xp >= 100) {
                        data.lv++; data.xp = 0;
                        document.getElementById('lv').innerText = data.lv;
                        tg.HapticFeedback.impactOccurred('heavy');
                    }
                }
            });
            if(entities.length < 3) spawnPrey();
        });

        // Controles de movimiento sencillos
        const joy = document.getElementById('joy');
        joy.addEventListener('touchmove', (e) => {
            const r = joy.getBoundingClientRect();
            joystick.x = (e.touches[0].clientX - (r.left + 40)) / 40;
            joystick.y = (e.touches[0].clientY - (r.top + 40)) / 40;
        });
        joy.addEventListener('touchend', () => { joystick.x = 0; joystick.y = 0; });

        function animate() {
            requestAnimationFrame(animate);
            if(wolf) {
                wolf.position.x += joystick.x * 0.2;
                wolf.position.z += joystick.y * 0.2;
                if(Math.abs(joystick.x) > 0.1) wolf.rotation.y = -Math.atan2(joystick.y, joystick.x) + Math.PI/2;
                camera.position.lerp(new THREE.Vector3(wolf.position.x, 6, wolf.position.z + 10), 0.1);
                camera.lookAt(wolf.position);
            }
            renderer.render(scene, camera);
        }
        init();
    </script>
</body>
</html>
