<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf Simulator MMO 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #050a05; font-family: 'Arial', sans-serif; touch-action: none; }
        #gui { position: fixed; top: 20px; left: 20px; color: white; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; border-left: 5px solid #daa520; pointer-events: none; z-index: 10; }
        #orb-ui { position: fixed; top: 20px; right: 20px; color: #ffd700; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; display: none; z-index: 10; font-weight: bold; }
        #controls { position: fixed; bottom: 40px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; box-sizing: border-box; z-index: 20; }
        .joystick-base { width: 120px; height: 120px; background: rgba(255,255,255,0.1); border: 2px solid rgba(255,255,255,0.3); border-radius: 50%; position: relative; }
        .joystick-stick { width: 50px; height: 50px; background: rgba(255,255,255,0.8); border-radius: 50%; position: absolute; top: 35px; left: 35px; transition: transform 0.1s; }
        .atk-btn { width: 90px; height: 90px; background: rgba(139,0,0,0.8); border: 3px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 40px; box-shadow: 0 0 20px rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <div id="gui">
        <b style="font-size: 18px;">üê∫ LOBO ALFA</b><br>
        Nivel: <span id="lv">1</span> | Mapa: <span id="mapa">1</span>
    </div>
    <div id="orb-ui">‚ú® Orbes: <span id="orbes">0</span>/60</div>

    <div id="controls">
        <div class="joystick-base" id="joy-base"><div class="joystick-stick" id="joy-stick"></div></div>
        <div class="atk-btn" onclick="atacar()">üêæ</div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.ready();

        let scene, camera, renderer, wolf, floor;
        let joystick = { x: 0, y: 0, active: false };
        let entities = [];
        let stats = { lv: 1, xp: 0, orbes: 0, mapa: 1 };

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x446688);
            scene.fog = new THREE.Fog(0x446688, 20, 100);

            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 7, 12);

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            document.body.appendChild(renderer.domElement);

            // Iluminaci√≥n realista
            const ambient = new THREE.AmbientLight(0xffffff, 0.6);
            scene.add(ambient);
            const sun = new THREE.DirectionalLight(0xffffff, 1);
            sun.position.set(10, 20, 10);
            sun.castShadow = true;
            scene.add(sun);

            // Suelo de bosque
            const floorGeo = new THREE.PlaneGeometry(1000, 1000);
            const floorMat = new THREE.MeshStandardMaterial({ color: 0x1b3012 });
            floor = new THREE.Mesh(floorGeo, floorMat);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // CREACI√ìN DEL LOBO (Cuerpo compuesto para mayor realismo)
            wolf = new THREE.Group();
            const body = new THREE.Mesh(new THREE.BoxGeometry(1.2, 1.2, 3), new THREE.MeshStandardMaterial({color: 0x4a4a4a}));
            const head = new THREE.Mesh(new THREE.BoxGeometry(0.9, 0.9, 1.2), new THREE.MeshStandardMaterial({color: 0x333333}));
            head.position.set(0, 0.6, 1.8);
            const tail = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.4, 1.5), new THREE.MeshStandardMaterial({color: 0x222222}));
            tail.position.set(0, 0.2, -1.8);
            wolf.add(body, head, tail);
            wolf.position.y = 0.6;
            wolf.castShadow = true;
            scene.add(wolf);

            spawnNature();
            animate();
        }

        function spawnNature() {
            // √Årboles 3D
            for(let i=0; i<150; i++) {
                const x = Math.random()*400-200;
                const z = Math.random()*400-200;
                const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.3, 0.3, 4), new THREE.MeshStandardMaterial({color: 0x3d2b1f}));
                trunk.position.set(x, 2, z);
                const leaves = new THREE.Mesh(new THREE.ConeGeometry(2, 5, 8), new THREE.MeshStandardMaterial({color: 0x0a290a}));
                leaves.position.set(x, 5, z);
                scene.add(trunk, leaves);
            }
            // Animales (Presas)
            const preyGeo = new THREE.SphereGeometry(0.6, 12, 12);
            for(let i=0; i<25; i++) {
                const p = new THREE.Mesh(preyGeo, new THREE.MeshStandardMaterial({color: 0xaa6644}));
                p.position.set(Math.random()*150-75, 0.6, Math.random()*150-75);
                scene.add(p);
                entities.push(p);
            }
        }

        function atacar() {
            tg.HapticFeedback.impactOccurred('heavy');
            entities.forEach((p, i) => {
                if(wolf.position.distanceTo(p.position) < 4) {
                    scene.remove(p);
                    entities.splice(i, 1);
                    stats.xp += 25;
                    
                    // REGLA DE ORBES: Nivel 20 o Mapa 4
                    if(stats.lv >= 20 || stats.mapa >= 4) {
                        document.getElementById('orb-ui').style.display = 'block';
                        if(Math.random() < 0.4) {
                            stats.orbes++;
                            document.getElementById('orbes').innerText = stats.orbes;
                            if(stats.orbes === 10) tg.showAlert("‚ú® ¬°Deseo √âpico!");
                            if(stats.orbes === 60) tg.showAlert("üî• ¬°Deseo Legendario!");
                        }
                    }

                    if(stats.xp >= 100) {
                        stats.lv++; stats.xp = 0;
                        document.getElementById('lv').innerText = stats.lv;
                        tg.showAlert("¬°Subiste de Nivel!");
                    }
                }
            });
            if(entities.length < 5) spawnNature();
        }

        // --- SISTEMA DE MOVIMIENTO ---
        const base = document.getElementById('joy-base');
        const stick
