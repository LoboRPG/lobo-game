<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf Simulator Professional 3D</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #0b1a07; font-family: 'Segoe UI', sans-serif; touch-action: none; }
        #ui-layer { position: fixed; top: 0; left: 0; width: 100%; pointer-events: none; z-index: 10; color: white; }
        .stat-card { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.7); padding: 15px; border-radius: 12px; border-left: 5px solid #daa520; backdrop-filter: blur(5px); }
        #orb-counter { position: absolute; top: 20px; right: 20px; background: rgba(218,165,32,0.2); padding: 15px; border-radius: 12px; border: 1px solid #daa520; color: #ffd700; display: none; font-weight: bold; }
        
        /* Controles Visuales */
        #controls { position: fixed; bottom: 40px; width: 100%; display: flex; justify-content: space-around; align-items: center; z-index: 20; }
        .joystick-zone { width: 120px; height: 120px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid rgba(255,255,255,0.4); position: relative; }
        .joystick-knob { width: 50px; height: 50px; background: radial-gradient(circle, #fff, #ccc); border-radius: 50%; position: absolute; top: 35px; left: 35px; box-shadow: 0 4px 10px rgba(0,0,0,0.5); }
        .attack-unit { width: 90px; height: 90px; background: linear-gradient(145deg, #8b0000, #5a0000); border-radius: 50%; border: 3px solid #fff; display: flex; align-items: center; justify-content: center; font-size: 40px; box-shadow: 0 0 20px rgba(139,0,0,0.6); pointer-events: auto; }
    </style>
</head>
<body>

    <div id="ui-layer">
        <div class="stat-card">
            <span style="font-size: 18px; letter-spacing: 1px;">üê∫ ALFA REAL</span><br>
            <small>NIVEL: <span id="val-lv">1</span> | MAPA: <span id="val-map">1</span></small>
        </div>
        <div id="orb-counter">‚ú® ORBES: <span id="val-orb">0</span>/60</div>
    </div>

    <div id="controls">
        <div class="joystick-zone" id="joy-area"><div class="joystick-knob" id="joy-knob"></div></div>
        <div class="attack-unit" id="btn-atk">üêæ</div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    let scene, camera, renderer, wolf, terrain;
    let joystick = { x: 0, y: 0, active: false };
    let preyList = [];
    let gameData = { lv: 1, xp: 0, orbes: 0, mapa: 1 };

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x87ceeb); // Cielo
        scene.fog = new THREE.FogExp2(0x87ceeb, 0.02); // Niebla realista

        camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
        
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true;
        document.body.appendChild(renderer.domElement);

        // Luces Pro
        const hemiLight = new THREE.HemisphereLight(0xffffff, 0x444444, 1);
        scene.add(hemiLight);
        const dirLight = new THREE.DirectionalLight(0xffffff, 0.8);
        dirLight.position.set(5, 10, 7);
        dirLight.castShadow = true;
        scene.add(dirLight);

        // Suelo con Textura de Bosque
        const groundGeo = new THREE.PlaneGeometry(1000, 1000);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x2d4c1e });
        terrain = new THREE.Mesh(groundGeo, groundMat);
        terrain.rotation.x = -Math.PI / 2;
        terrain.receiveShadow = true;
        scene.add(terrain);

        // --- CONSTRUCCI√ìN DEL LOBO DETALLADO ---
        wolf = new THREE.Group();
        const matLobo = new THREE.MeshStandardMaterial({ color: 0x444444 });
        
        const cuerpo = new THREE.Mesh(new THREE.BoxGeometry(1, 1.1, 2.2), matLobo);
        const cabeza = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.8, 0.9), matLobo);
        cabeza.position.set(0, 0.6, 1.2);
        
        const hocico = new THREE.Mesh(new THREE.BoxGeometry(0.4, 0.4, 0.5), new THREE.MeshStandardMaterial({color: 0x222222}));
        hocico.position.set(0, 0.5, 1.8);
        
        const orejaL = new THREE.Mesh(new THREE.BoxGeometry(0.2, 0.4, 0.1), matLobo);
        orejaL.position.set(0.25, 1.1, 1.1);
        const orejaR = orejaL.clone();
        orejaR.position.x = -0.25;

        // Patas
        const pataGeo = new THREE.BoxGeometry(0.3, 0.8, 0.3);
        const p1 = new THREE.Mesh(pataGeo, matLobo); p1.position.set(0.3, -0.5, 0.8);
        const p2 = p1.clone(); p2.position.x = -0.3;
        const p3 = p1.clone(); p3.position.z = -0.8;
        const p4 = p3.clone(); p4.position.x = -0.3;

        wolf.add(cuerpo, cabeza, hocico, orejaL, orejaR, p1, p2, p3, p4);
        wolf.position.y = 1.2;
        wolf.castShadow = true;
        scene.add(wolf);

        // Vegetaci√≥n
        for(let i=0; i<80; i++) spawnTree();
        spawnPrey();
        animate();
    }

    function spawnTree() {
        const tree = new THREE.Group();
        const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.3, 3), new THREE.MeshStandardMaterial({color: 0x3d2b1f}));
        const leaves = new THREE.Mesh(new THREE.ConeGeometry(1.5, 4, 8), new THREE.MeshStandardMaterial({color: 0x133d13}));
        leaves.position.y = 3;
        tree.add(trunk, leaves);
        tree.position.set(Math.random()*200-100, 1.5, Math.random()*200-100);
        scene.add(tree);
    }

    function spawnPrey() {
        const geo = new THREE.SphereGeometry(0.6, 16, 16);
        const mat = new THREE.MeshStandardMaterial({ color: 0xd2691e });
        for(let i=0; i<15; i++) {
            const p = new THREE.Mesh(geo, mat);
            p.position.set(Math.random()*80-40, 0.6, Math.random()*80-40);
            scene.add(p);
            preyList.push(p);
        }
    }

    // --- L√ìGICA DE ORBES (Tus reglas) ---
    function checkOrbs() {
        if(gameData.lv >= 20 || gameData.mapa >= 4) {
            document.getElementById('orb-counter').style.display = 'block';
            if(Math.random() < 0.45) { // Probabilidad equilibrada
                gameData.orbes++;
                document.getElementById('val-orb').innerText = gameData.orbes;
                if(gameData.orbes === 10) tg.showAlert("¬°Deseo √âpico desbloqueado!");
                if(gameData.orbes === 60) tg.showAlert("¬°PODER LEGENDARIO!");
            }
        }
    }

    // Controles
    const area = document.getElementById('joy-area');
    const knob = document.getElementById('joy-knob');
    area.addEventListener('touchmove', e => {
        const r = area.getBoundingClientRect();
        const x = e.touches[0].clientX - (r.left + 60);
        const y = e.touches[0].clientY - (r.top + 60);
        const d = Math.min(Math.sqrt(x*x+y*y), 40);
        const angle = Math.atan2(y, x);
        joystick.x = Math.cos(angle) * (d/40);
        joystick.y = Math.sin(angle) * (d/40);
        knob.style.transform = `translate(${Math.cos(angle)*d}px, ${Math.sin(angle)*d}px)`;
    });
    area.addEventListener('touchend', () => {
        joystick.x = 0; joystick.y = 0;
        knob.style.transform = 'translate(0,0)';
    });

    document.getElementById('btn-atk').addEventListener('touchstart', () => {
        tg.HapticFeedback.impactOccurred('medium');
        preyList.forEach((p, i) => {
            if(wolf.position.distanceTo(p.position) < 4) {
                scene.remove(p);
                preyList.splice(i, 1);
                gameData.xp += 35;
                checkOrbs();
                if(gameData.xp >= 100) {
                    gameData.lv++; gameData.xp = 0;
                    document.getElementById('val-lv').innerText = gameData.lv;
                }
            }
        });
        if(preyList.length < 5) spawnPrey();
    });

    function animate() {
        requestAnimationFrame(animate);
        if(wolf) {
            wolf.position.x += joystick.x * 0.3;
            wolf.position.z += joystick.y * 0.3;
            if(Math.abs(joystick.x) > 0.1 || Math.abs(joystick.y) > 0.1) {
                wolf.rotation.y = -Math.atan2(joystick.y, joystick.x) + Math.PI/2;
            }
            camera.position.set(wolf.position.x, wolf.position.y + 8, wolf.position.z + 12);
            camera.lookAt(wolf.position);
        }
        renderer.render(scene, camera);
    }
    init();
</script>
</body>
</html>
