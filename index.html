<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf Hunter: Color Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; }
        #ui { position: absolute; top: 10px; left: 10px; z-index: 10; pointer-events: none; }
        .stat-box { background: rgba(0,0,0,0.8); color: #fff; padding: 8px 12px; border-radius: 8px; font-weight: bold; pointer-events: auto; margin-bottom: 5px; border: 1px solid #444; font-size: 14px; }
        #altar-btn { background: #ffd700; color: #000; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; pointer-events: auto; font-weight: bold; }
        #wish-menu { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: none; flex-direction: column; align-items: center; justify-content: center; z-index: 100; color: white; text-align: center; }
    </style>
</head>
<body>

<div id="ui">
    <div class="stat-box" id="info">Lvl: 1 | Orbes: 0</div>
    <button id="altar-btn" onclick="document.getElementById('wish-menu').style.display='flex'">ðŸŒ• ALTAR</button>
</div>

<div id="wish-menu">
    <h2 style="color: gold;">Altar de Deseos</h2>
    <p>Orbes: <span id="orb-count">0</span></p>
    <p style="font-size: 12px; color: #888;">Regla: 10 Orbes (Ã‰pico) | 60 Orbes (Legendario)<br>Disponibles desde Nivel 20</p>
    <button onclick="document.getElementById('wish-menu').style.display='none'" style="margin-top:20px; padding:10px 30px;">Cerrar</button>
</div>

<script>
// --- DATOS INICIALES ---
let data = JSON.parse(localStorage.getItem('wolf_color_save')) || { level: 1, exp: 0, orbes: 0, mapa: 1, vel: 210, color: 0xffffff };

const colors = [0xffffff, 0x00ff00, 0x00ffff, 0x0000ff, 0xff00ff, 0xffff00, 0xff4500, 0xff0000];

function save() {
    localStorage.setItem('wolf_color_save', JSON.stringify(data));
    document.getElementById('info').innerText = `Lvl: ${data.level} | Mapa: ${data.mapa} | Orbes: ${data.orbes}`;
    document.getElementById('orb-count').innerText = data.orbes;
}

const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    backgroundColor: '#050505',
    physics: { default: 'arcade' },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let player, preys, audioCtx;

function preload() {
    this.load.image('bg', 'https://labs.phaser.io/assets/skies/space3.png');
}

function playSound(f, d) {
    if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    let o = audioCtx.createOscillator();
    let g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.setValueAtTime(f, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + d);
    o.connect(g); g.connect(audioCtx.destination);
    o.start(); o.stop(audioCtx.currentTime + d);
}

function create() {
    this.add.tileSprite(0, 0, 5000, 5000, 'bg').setAlpha(0.1);
    this.cameras.main.setBounds(0, 0, 2500, 2500);
    this.physics.world.setBounds(0, 0, 2500, 2500);

    // Jugador con el color guardado
    player = this.add.circle(500, 500, 15, data.color);
    this.physics.add.existing(player);
    player.body.setCollideWorldBounds(true);
    this.cameras.main.startFollow(player, true, 0.1, 0.1);

    preys = this.physics.add.group();
    for(let i=0; i<20; i++) spawnPrey(this);

    this.physics.add.overlap(player, preys, (p, prey) => {
        prey.destroy();
        playSound(200, 0.1);
        data.exp += 34;

        if(data.exp >= 100) {
            data.level++;
            data.exp = 0;
            data.mapa = Math.floor(data.level/5) + 1;
            // CAMBIO DE COLOR AL SUBIR DE NIVEL
            data.color = colors[data.level % colors.length];
            player.setFillStyle(data.color);
            playSound(500, 0.3);
        }

        // REGLA: Orbes en Nivel 20 o Mapa 4
        if(data.level >= 20 || data.mapa >= 4) {
            if(Math.random() < 0.25) {
                data.orbes++;
                playSound(900, 0.4);
            }
        }
        save();
        spawnPrey(this);
    }, null, this);

    save();
}

function update() {
    if (this.input.activePointer.isDown) {
        this.physics.moveToObject(player, this.input.activePointer, data.vel);
    } else {
        player.body.setVelocity(0);
    }
}

function spawnPrey(scene) {
    let x = Phaser.Math.Between(100, 2400);
    let y = Phaser.Math.Between(100, 2400);
    let p = scene.add.circle(x, y, 10, 0x00ff88);
    scene.physics.add.existing(p);
    preys.add(p);
}
</script>
</body>
</html>
