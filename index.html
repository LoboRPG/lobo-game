<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf Online Simulator MMO</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root { --gold: #daa520; --bg: #0a0f08; }
        body { margin: 0; padding: 0; background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; filter: saturate(1.2) contrast(1.1); }

        /* HUD Realista */
        #gui { position: fixed; top: 0; left: 0; width: 100%; pointer-events: none; z-index: 10; }
        .stats-box { position: absolute; top: 15px; left: 15px; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 5px; border-left: 4px solid var(--gold); }
        .orb-panel { position: absolute; top: 15px; right: 15px; background: rgba(0,0,0,0.6); padding: 10px; border-radius: 5px; color: var(--gold); font-weight: bold; display: none; }
        
        /* Controles */
        .controls { position: fixed; bottom: 25px; right: 25px; display: flex; gap: 15px; z-index: 20; }
        .action-btn { width: 75px; height: 75px; background: rgba(0,0,0,0.5); border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; pointer-events: auto; }
        
        /* Joystick Virtual */
        #joy-outer { position: fixed; bottom: 40px; left: 40px; width: 120px; height: 120px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.3); border-radius: 50%; z-index: 20; }
        #joy-inner { position: absolute; top: 35px; left: 35px; width: 50px; height: 50px; background: white; border-radius: 50%; opacity: 0.6; }

        /* Pantalla de Inicio / Modos */
        #overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.85); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; text-align: center; padding: 20px; }
        .menu-btn { background: var(--gold); color: black; border: none; padding: 15px 40px; margin: 10px; font-weight: bold; border-radius: 30px; font-size: 18px; width: 250px; cursor: pointer; }
    </style>
</head>
<body>

    <div id="overlay">
        <h1 style="color:var(--gold); font-size: 40px; margin-bottom: 5px;">WOLF MMO</h1>
        <p>Simulador de Rol Multijugador Realista</p>
        <button class="menu-btn" onclick="startGame('hunt')">MODO CACER√çA (CO-OP)</button>
        <button class="menu-btn" onclick="startGame('pvp')" style="background:#8b0000; color:white;">ARENA BATTLE (PVP)</button>
        <p style="font-size: 12px; opacity: 0.7;">Toca para elegir tu destino como Alfa</p>
    </div>

    <div id="gui">
        <div class="stats-box">
            <div id="p-name">Lobo Alfa</div>
            <div style="font-size: 12px;">Nivel: <span id="lv">1</span> | Mapa: <span id="map-num">1</span></div>
            <div style="width: 120px; height: 4px; background: #333; margin-top: 5px;">
                <div id="xp-bar" style="width: 0%; height: 100%; background: var(--gold);"></div>
            </div>
        </div>
        <div class="orb-panel" id="orb-display">‚ú® Orbes: <span id="orb-count">0</span></div>
    </div>

    <div id="joy-outer"><div id="joy-inner"></div></div>

    <div class="controls">
        <div class="action-btn" id="attack-btn">üêæ</div>
        <div class="action-btn" id="map-btn" style="border-color: #27ae60; font-size: 24px;">üó∫Ô∏è</div>
    </div>

    <canvas id="gameCanvas"></canvas>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();
    tg.expand();

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Variables de Juego
    let worldSize = 5000;
    let player = { x: 2500, y: 2500, lv: 1, xp: 0, orbes: 0, mapa: 1, angle: 0, speed: 5 };
    let camera = { x: 0, y: 0 };
    let enemies = [];
    let joystick = { active: false, x: 0, y: 0, angle: 0 };
    let gameActive = false;

    function startGame(mode) {
        document.getElementById('overlay').style.display = 'none';
        gameActive = true;
        tg.HapticFeedback.notificationOccurred('success');
        spawnEnemies();
        requestAnimationFrame(gameLoop);
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
    }
    window.addEventListener('resize', resize);
    resize();

    function spawnEnemies() {
        enemies = [];
        const types = ['üê∞', 'ü¶ä', 'ü¶å', 'üêÇ', 'üêøÔ∏è'];
        for(let i=0; i<30; i++) {
            enemies.push({
                x: Math.random() * worldSize,
                y: Math.random() * worldSize,
                type: types[Math.floor(Math.random()*types.length)],
                hp: 100, dead: false
            });
        }
    }

    // --- REGLAS DE ORBES ---
    function checkOrbsLogic() {
        // Regla: Nivel 20 o Mapa 4
        if(player.lv >= 20 || player.mapa >= 4) {
            document.getElementById('orb-display').style.display = 'block';
            // Probabilidad equilibrada (40%)
            if(Math.random() < 0.4) {
                player.orbes++;
                document.getElementById('orb-count').innerText = player.orbes;
                
                if(player.orbes === 10) tg.showAlert("¬°DESEO √âPICO DISPONIBLE! (10 Orbes)");
                if(player.orbes === 60) tg.showAlert("¬°DESEO LEGENDARIO ALCANZADO! (60 Orbes)");
            }
        }
    }

    function attack() {
        tg.HapticFeedback.impactOccurred('heavy');
        enemies.forEach(en => {
            if(!en.dead) {
                let d = Math.hypot(en.x - player.x, en.y - player.y);
                if(d < 120) {
                    en.dead = true;
                    player.xp += 34;
                    checkOrbsLogic();
                    if(player.xp >= 100) {
                        player.lv++;
                        player.xp = 0;
                        if(player.lv === 20) tg.showAlert("¬°Nivel 20! Ahora puedes cazar Orbes.");
                        document.getElementById('lv').innerText = player.lv;
                    }
                    document.getElementById('xp-bar').style.width = (player.xp) + "%";
                }
            }
        });
    }

    function nextMap() {
        player.mapa++;
        player.x = 2500; player.y = 2500;
        document.getElementById('map-num').innerText = player.mapa;
        if(player.mapa === 4) tg.showAlert("¬°Mapa 4: Tierra de Orbes!");
        spawnEnemies();
    }

    // --- CONTROLES ---
    document.getElementById('attack-btn').addEventListener('touchstart', attack);
    document.getElementById('map-btn').addEventListener('touchstart', nextMap);

    const joyOuter = document.getElementById('joy-outer');
    const joyInner = document.getElementById('joy-inner');

    window.addEventListener('touchstart', e => {
        if(e.touches[0].clientX < window.innerWidth/2) joystick.active = true;
    });

    window.addEventListener('touchmove', e => {
        if(!joystick.active) return;
        let t = e.touches[0];
        let rect = joyOuter.getBoundingClientRect();
        let dx = t.clientX - (rect.left + 60);
        let dy = t.clientY - (rect.top + 60);
        let dist = Math.min(Math.sqrt(dx*dx + dy*dy), 40);
        joystick.angle = Math.atan2(dy, dx);
        joystick.x = Math.cos(joystick.angle) * (dist/40);
        joystick.y = Math.sin(joystick.angle) * (dist/40);
        joyInner.style.transform = `translate(${Math.cos(joystick.angle)*dist}px, ${Math.sin(joystick.angle)*dist}px)`;
    });

    window.addEventListener('touchend', () => {
        joystick.active = false; joystick.x = 0; joystick.y = 0;
        joyInner.style.transform = `translate(0,0)`;
    });

    // --- LOOP PRINCIPAL ---
    function gameLoop() {
        if(!gameActive) return;

        player.x += joystick.x * player.speed;
        player.y += joystick.y * player.speed;
        
        camera.x = player.x - canvas.width / 2;
        camera.y = player.y - canvas.height / 2;

        // Dibujar Fondo
        ctx.fillStyle = '#141d0f';
        ctx.fillRect(0,0, canvas.width, canvas.height);

        ctx.save();
        ctx.translate(-camera.x, -camera.y);

        // Grid de bosque
        ctx.strokeStyle = "rgba(255,255,255,0.05)";
        for(let i=0; i<worldSize; i+=200) {
            ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i, worldSize); ctx.stroke();
            ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(worldSize, i); ctx.stroke();
        }

        // Animales
        ctx.font = "40px Arial";
        enemies.forEach(en => {
            if(!en.dead) ctx.fillText(en.type, en.x, en.y);
        });

        // Lobo (Jugador) con efecto de sombra
        ctx.shadowBlur = 15;
        ctx.shadowColor = "white";
        ctx.fillText("üê∫", player.x - 20, player.y + 15);
        ctx.shadowBlur = 0;

        ctx.restore();
        requestAnimationFrame(gameLoop);
    }
</script>
</body>
</html>
