<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf Simulator MMO - Orbes de Poder</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; padding: 0; background: #0b1a07; overflow: hidden; font-family: 'Segoe UI', sans-serif; touch-action: none; color: white; }
        canvas { display: block; background: #1a2e15; }
        
        /* Interfaz Superior */
        .hud-top { position: fixed; top: 10px; left: 10px; z-index: 1000; background: rgba(0,0,0,0.8); padding: 10px; border-radius: 10px; border: 2px solid #daa520; font-size: 14px; }
        #orb-display { color: #f1c40f; font-weight: bold; margin-top: 5px; display: none; }

        /* Botones Inferiores */
        .controls-bottom { position: fixed; bottom: 20px; right: 20px; display: flex; gap: 10px; z-index: 1000; }
        .btn { width: 60px; height: 60px; border-radius: 50%; border: 2px solid #fff; background: rgba(0,0,0,0.8); display: flex; align-items: center; justify-content: center; font-size: 24px; color: white; cursor: pointer; }
        
        /* Joystick Visual */
        #joy-base { position: fixed; bottom: 40px; left: 40px; width: 100px; height: 100px; background: rgba(255,255,255,0.1); border-radius: 50%; border: 2px solid rgba(255,255,255,0.3); z-index: 1000; }
        #joy-stick { position: absolute; top: 25px; left: 25px; width: 50px; height: 50px; background: white; border-radius: 50%; transition: transform 0.1s; }
    </style>
</head>
<body>

    <div class="hud-top">
        üê∫ <b><span id="p-name">Lobo</span></b> | LV: <span id="lv">1</span> | Mapa: <span id="mapa">1</span>
        <div id="orb-display">‚ú® Orbes: <span id="orbes">0</span>/60</div>
    </div>

    <div class="controls-bottom">
        <div class="btn" onclick="atacar()">‚öîÔ∏è</div>
        <div class="btn" onclick="siguienteMapa()" style="background:#27ae60">üó∫Ô∏è</div>
    </div>

    <div id="joy-base"><div id="joy-stick"></div></div>
    <canvas id="gameCanvas"></canvas>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    
    // Estado del Juego (Tus Reglas)
    let player = { x: 0, y: 0, lv: 1, xp: 0, orbes: 0, mapa: 1, size: 40 };
    let entities = [];
    let joystick = { active: false, x: 0, y: 0 };
    let camera = { x: 0, y: 0 };

    function init() {
        resize();
        spawnEntities();
        loop();
    }

    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.x = canvas.width / 2;
        player.y = canvas.height / 2;
    }

    function spawnEntities() {
        entities = [];
        for(let i=0; i<20; i++) {
            entities.push({
                x: (Math.random() - 0.5) * 3000,
                y: (Math.random() - 0.5) * 3000,
                emoji: 'ü¶å',
                dead: false
            });
        }
    }

    // L√ìGICA DE ATAQUE Y ORBES (Tus reglas exactas)
    function atacar() {
        entities.forEach(en => {
            let dx = en.x - (player.x + camera.x);
            let dy = en.y - (player.y + camera.y);
            let dist = Math.sqrt(dx*dx + dy*dy);

            if(dist < 100 && !en.dead) {
                en.dead = true;
                player.xp += 20;
                
                // REGLA: Aparecen orbes en Mapa 4 o Nivel 20
                if(player.lv >= 20 || player.mapa >= 4) {
                    document.getElementById('orb-display').style.display = 'block';
                    // Probabilidad ni f√°cil ni dif√≠cil (40%)
                    if(Math.random() < 0.4) {
                        player.orbes++;
                        checkDeseos();
                    }
                }
                checkLevel();
            }
        });
    }

    function checkDeseos() {
        if(player.orbes === 10) tg.showAlert("¬°CONCEDIDO! Tienes 10 orbes para un deseo √âPICO.");
        if(player.orbes === 60) tg.showAlert("¬°PODER LEGENDARIO! 60 orbes para el gran deseo.");
        document.getElementById('orbes').innerText = player.orbes;
    }

    function checkLevel() {
        if(player.xp >= 100) {
            player.lv++;
            player.xp = 0;
            if(player.lv === 20) tg.showAlert("¬°Nivel 20! Ahora puedes encontrar orbes cazando.");
            document.getElementById('lv').innerText = player.lv;
        }
    }

    function siguienteMapa() {
        player.mapa++;
        if(player.mapa === 4) tg.showAlert("¬°Mapa 4! Los orbes han comenzado a aparecer.");
        document.getElementById('mapa').innerText = player.mapa;
        spawnEntities();
    }

    // CONTROLES T√ÅCTILES (Arreglado para tu celular)
    const joyBase = document.getElementById('joy-base');
    const joyStick = document.getElementById('joy-stick');

    window.addEventListener('touchstart', e => {
        const t = e.touches[0];
        if(t.clientX < window.innerWidth / 2) { // Solo si toca el lado izquierdo
            joystick.active = true;
        }
    });

    window.addEventListener('touchmove', e => {
        if(!joystick.active) return;
        const t = e.touches[0];
        const baseRect = joyBase.getBoundingClientRect();
        const centerX = baseRect.left + baseRect.width / 2;
        const centerY = baseRect.top + baseRect.height / 2;
        
        let dx = t.clientX - centerX;
        let dy = t.clientY - centerY;
        let dist = Math.min(Math.sqrt(dx*dx + dy*dy), 40);
        let angle = Math.atan2(dy, dx);

        joystick.x = Math.cos(angle) * (dist / 10);
        joystick.y = Math.sin(angle) * (dist / 10);
        
        joyStick.style.transform = `translate(${Math.cos(angle)*dist}px, ${Math.sin(angle)*dist}px)`;
    });

    window.addEventListener('touchend', () => {
        joystick.active = false;
        joystick.x = 0; joystick.y = 0;
        joyStick.style.transform = `translate(0,0)`;
    });

    function loop() {
        // Movimiento de c√°mara
        camera.x += joystick.x;
        camera.y += joystick.y;

        // Dibujar
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        
        // Entidades
        ctx.font = '30px Arial';
        entities.forEach(en => {
            if(!en.dead) {
                ctx.fillText(en.emoji, en.x - camera.x, en.y - camera.y);
            }
        });

        // Jugador (Lobo)
        ctx.font = '40px Arial';
        ctx.fillText('üê∫', player.x - 20, player.y + 15);

        requestAnimationFrame(loop);
    }

    window.addEventListener('resize', resize);
    init();
</script>
</body>
</html>
