<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ALFA RPG LEGEND</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #gui { position: fixed; top: 15px; left: 15px; color: #2ecc71; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; border: 1px solid #2ecc71; z-index: 10; }
        #mission-box { position: fixed; top: 15px; right: 15px; color: #ffd700; background: rgba(0,0,0,0.8); padding: 15px; border-radius: 10px; display: none; }
        #controls { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: space-around; }
        .circle { width: 80px; height: 80px; background: rgba(255,255,255,0.2); border: 2px solid #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: #fff; touch-action: none; }
    </style>
</head>
<body>
    <div id="gui">
        üê∫ <b>WOLF ALFA RPG</b><br>
        NIVEL: <span id="val-lv">1</span><br>
        MAPA: <span id="val-map">1</span>
    </div>
    <div id="mission-box">‚ú® ORBES: <span id="val-orb">0</span>/60</div>

    <div id="controls">
        <div class="circle" id="move-pad">üïπÔ∏è</div>
        <div class="circle" id="attack-btn" style="background: #e74c3c;">‚öîÔ∏è</div>
    </div>

<script>
    let scene, camera, renderer, wolf, joy = {x:0, y:0}, entities = [];
    let state = { lv: 1, xp: 0, orbes: 0, mapa: 1 };

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x1a2e15); // Verde Bosque
        
        camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight, 0.1, 1000);
        camera.position.set(0, 7, 12);

        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        scene.add(new THREE.AmbientLight(0xffffff, 0.8));
        const light = new THREE.DirectionalLight(0xffffff, 1);
        light.position.set(5, 10, 5);
        scene.add(light);

        // Suelo
        const ground = new THREE.Mesh(new THREE.PlaneGeometry(100, 100), new THREE.MeshStandardMaterial({color: 0x145214}));
        ground.rotation.x = -Math.PI/2;
        scene.add(ground);

        // CONSTRUCCI√ìN DEL LOBO (SIN ARCHIVOS EXTERNOS)
        wolf = new THREE.Group();
        const fur = new THREE.MeshStandardMaterial({color: 0x333333});
        
        const body = new THREE.Mesh(new THREE.BoxGeometry(0.8, 0.9, 2), fur);
        const head = new THREE.Mesh(new THREE.BoxGeometry(0.6, 0.6, 0.7), fur);
        head.position.set(0, 0.5, 1.1);
        
        const leg = new THREE.BoxGeometry(0.2, 0.8, 0.2);
        for(let i=0; i<4; i++){
            const l = new THREE.Mesh(leg, fur);
            l.position.set(i%2?0.3:-0.3, -0.5, i<2?0.7:-0.7);
            wolf.add(l);
        }
        wolf.add(body, head);
        wolf.position.y = 1;
        scene.add(wolf);

        spawnPrey();
        animate();
    }

    function spawnPrey() {
        const mat = new THREE.MeshStandardMaterial({color: 0xd2691e});
        for(let i=0; i<5; i++) {
            const p = new THREE.Mesh(new THREE.SphereGeometry(0.4), mat);
            p.position.set(Math.random()*20-10, 0.4, Math.random()*20-10);
            scene.add(p);
            entities.push(p);
        }
    }

    function checkOrbs() {
        // Regla: Nivel 20 o Mapa 4
        if(state.lv >= 20 || state.mapa >= 4) {
            document.getElementById('mission-box').style.display = 'block';
            // Probabilidad equilibrada (45%)
            if(Math.random() < 0.45) {
                state.orbes++;
                document.getElementById('val-orb').innerText = state.orbes;
                if(state.orbes === 10) alert("¬°Deseo √âpico Desbloqueado!");
                if(state.orbes === 60) alert("¬°Deseo Legendario Desbloqueado!");
            }
        }
    }

    // Controles
    const pad = document.getElementById('move-pad');
    pad.addEventListener('touchmove', e => {
        const r = pad.getBoundingClientRect();
        joy.x = (e.touches[0].clientX - (r.left + 40)) / 40;
        joy.y = (e.touches[0].clientY - (r.top + 40)) / 40;
    });
    pad.addEventListener('touchend', () => joy = {x:0, y:0});

    document.getElementById('attack-btn').addEventListener('touchstart', () => {
        entities.forEach((p, i) => {
            if(wolf.position.distanceTo(p.position) < 3) {
                scene.remove(p);
                entities.splice(i, 1);
                state.xp += 50;
                checkOrbs();
                if(state.xp >= 100) {
                    state.lv++; state.xp = 0;
                    document.getElementById('val-lv').innerText = state.lv;
                }
            }
        });
        if(entities.length < 2) spawnPrey();
    });

    function animate() {
        requestAnimationFrame(animate);
        if(wolf) {
            wolf.position.x += joy.x * 0.2;
            wolf.position.z += joy.y * 0.2;
            if(Math.abs(joy.x) > 0.1) wolf.rotation.y = -Math.atan2(joy.y, joy.x) + Math.PI/2;
            camera.position.set(wolf.position.x, 7, wolf.position.z + 12);
            camera.lookAt(wolf.position);
        }
        renderer.render(scene, camera);
    }
    init();
</script>
</body>
</html>
