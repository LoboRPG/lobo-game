<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf RPG: Alpha Hunter</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/phaser/3.60.0/phaser.min.js"></script>
    <style>
        body { margin: 0; background: #051005; overflow: hidden; font-family: 'Segoe UI', sans-serif; }
        #ui-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 10; }
        .hud-v2 { position: absolute; top: 20px; left: 20px; background: rgba(0,0,0,0.8); border-radius: 15px; padding: 15px; border: 1px solid rgba(0,255,204,0.3); backdrop-filter: blur(5px); pointer-events: auto; }
        .label-lvl { color: #00ffcc; font-weight: bold; font-size: 18px; text-transform: uppercase; }
        .label-stats { color: #ffd700; font-size: 12px; margin-top: 4px; font-weight: 600; }
        #altar-btn { position: absolute; bottom: 35px; left: 50%; transform: translateX(-50%); background: linear-gradient(180deg, #ffd700, #b8860b); color: #000; border: none; padding: 15px 45px; border-radius: 30px; cursor: pointer; pointer-events: auto; font-weight: bold; font-size: 16px; box-shadow: 0 8px 20px rgba(0,0,0,0.6); }
    </style>
</head>
<body>

<div id="ui-layer">
    <div class="hud-v2">
        <div class="label-lvl" id="info">üê∫ ALFA LVL: 1</div>
        <div class="label-stats" id="stats">MAPA: 1 | ORBES: 0</div>
    </div>
    <button id="altar-btn" onclick="showAltar()">üåï ALTAR SAGRADO</button>
</div>

<script>
// Usamos una nueva versi√≥n de datos para asegurar el refresco visual
let data = JSON.parse(localStorage.getItem('wolf_v8_final')) || { level: 1, exp: 0, orbes: 0, mapa: 1, vel: 270, color: 0xffffff };

function save() {
    localStorage.setItem('wolf_v8_final', JSON.stringify(data));
    document.getElementById('info').innerText = `üê∫ ALFA LVL: ${data.level}`;
    document.getElementById('stats').innerText = `MAPA: ${data.mapa} | ORBES: ${data.orbes}`;
}

const config = {
    type: Phaser.AUTO,
    width: window.innerWidth,
    height: window.innerHeight,
    physics: { default: 'arcade' },
    scene: { preload: preload, create: create, update: update }
};

const game = new Phaser.Game(config);
let player, preys, bg;

function preload() {
    this.load.image('grass_bg', 'https://labs.phaser.io/assets/textures/grass.png');
    this.load.image('wolf_img', 'https://img.icons8.com/color/144/wolf.png');
    this.load.image('deer_img', 'https://img.icons8.com/color/96/deer.png');
}

function create() {
    // Fondo con textura de hierba mejorada
    bg = this.add.tileSprite(0, 0, 4000, 4000, 'grass_bg').setOrigin(0).setAlpha(0.35);
    this.cameras.main.setBounds(0, 0, 3000, 3000);
    this.physics.world.setBounds(0, 0, 3000, 3000);

    // Personaje principal: El Lobo
    player = this.physics.add.sprite(window.innerWidth/2, window.innerHeight/2, 'wolf_img');
    player.setScale(0.9); // Tama√±o equilibrado para RPG
    player.setTint(data.color);
    player.setCollideWorldBounds(true);
    
    // C√°mara cinematogr√°fica
    this.cameras.main.startFollow(player, true, 0.07, 0.07);

    preys = this.physics.add.group();
    for(let i=0; i<12; i++) spawnAnimal(this);

    // Sistema de Colisi√≥n y Reglas de Orbes
    this.physics.add.overlap(player, preys, (p, animal) => {
        animal.destroy();
        data.exp += 34;
        
        // Efecto visual de "impacto"
        this.cameras.main.shake(150, 0.005);

        if(data.exp >= 100) {
            data.level++;
            data.exp = 0;
            data.mapa = Math.floor(data.level/5) + 1;
            // El lobo cambia de color al subir de nivel
            data.color = Phaser.Display.Color.RandomRGB().color;
            player.setTint(data.color);
        }

        // REGLA: Orbes aparecen en Nivel 20 o Mapa 4
        if(data.level >= 20 || data.mapa >= 4) {
            if(Math.random() < 0.25) {
                data.orbes++;
            }
        }
        
        save();
        spawnAnimal(this);
    }, null, this);

    save();
}

function update() {
    if (this.input.activePointer.isDown) {
        this.physics.moveToObject(player, this.input.activePointer, data.vel);
        let angle = Phaser.Math.Angle.Between(player.x, player.y, this.input.activePointer.worldX, this.input.activePointer.worldY);
        // Rotaci√≥n suave hacia el objetivo
        player.rotation = Phaser.Math.Angle.RotateTo(player.rotation, angle + 1.5, 0.15);
    } else {
        player.body.setVelocity(0);
    }
}

function spawnAnimal(scene) {
    let x = Phaser.Math.Between(100, 2900);
    let y = Phaser.Math.Between(100, 2900);
    let animal = scene.physics.add.sprite(x, y, 'deer_img');
    animal.setScale(0.6);
    // A√±adimos movimiento suave a las presas para que parezcan vivas
    scene.tweens.add({
        targets: animal,
        x: animal.x + Phaser.Math.Between(-40, 40),
        y: animal.y + Phaser.Math.Between(-40, 40),
        duration: 3000,
        yoyo: true,
        repeat: -1
    });
    preys.add(animal);
}

function showAltar() {
    alert("‚ú® ALTAR DE ORBES ‚ú®\n\nOrbes: " + data.orbes + "\n\n10 Orbes: Deseo √âpico\n60 Orbes: Deseo Legendario\n\n(Aparecen tras alcanzar el Nivel 20)");
}
</script>
</body>
</html>
