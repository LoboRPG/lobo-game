<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Wolf MMO - Realistic Simulator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #020502; font-family: 'Courier New', monospace; touch-action: none; }
        #ui { position: fixed; top: 15px; left: 15px; z-index: 10; color: #fff; pointer-events: none; }
        .panel { background: rgba(0,20,0,0.8); padding: 10px; border: 1px solid #2ecc71; border-radius: 4px; margin-bottom: 5px; }
        #orb-alert { color: #f1c40f; font-weight: bold; display: none; text-shadow: 0 0 10px #f1c40f; }
        
        #controls { position: fixed; bottom: 30px; width: 100%; display: flex; justify-content: space-around; align-items: center; z-index: 20; }
        .joy-base { width: 110px; height: 110px; background: rgba(255,255,255,0.05); border: 2px solid #2ecc71; border-radius: 50%; position: relative; }
        .joy-stick { width: 45px; height: 45px; background: #2ecc71; border-radius: 50%; position: absolute; top: 32.5px; left: 32.5px; box-shadow: 0 0 15px #2ecc71; }
        .btn-atk { width: 85px; height: 85px; background: #c0392b; border: 3px solid #fff; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-size: 35px; box-shadow: 0 0 20px #c0392b; }
    </style>
</head>
<body>

    <div id="ui">
        <div class="panel">
            üê∫ <span id="name">WOLF_ALFA</span><br>
            NIVEL: <span id="lv">1</span> | MAPA: <span id="mp">1</span>
        </div>
        <div id="orb-alert" class="panel">‚ú® ORBES: <span id="orb-num">0</span>/60</div>
    </div>

    <div id="controls">
        <div class="joy-base" id="joy-b"><div class="joy-stick" id="joy-s"></div></div>
        <div class="btn-atk" id="atk">‚öîÔ∏è</div>
    </div>

<script>
    const tg = window.Telegram.WebApp;
    tg.ready();

    let scene, camera, renderer, wolf, floor;
    let joystick = { x: 0, y: 0, active: false };
    let preys = [];
    let state = { lv: 1, xp: 0, orbes: 0, mapa: 1 };

    function init() {
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x050a05);
        scene.fog = new THREE.FogExp2(0x050a05, 0.05);

        camera = new THREE.PerspectiveCamera(65, window.innerWidth / window.innerHeight, 0.1, 500);
        
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        // Iluminaci√≥n de bosque nocturno
        const moonLight = new THREE.DirectionalLight(0x44aaff, 0.8);
        moonLight.position.set(10, 20, 10);
        scene.add(moonLight);
        scene.add(new THREE.AmbientLight(0x112211, 1));

        // Suelo Org√°nico
        const groundGeo = new THREE.PlaneGeometry(1000, 1000);
        const groundMat = new THREE.MeshStandardMaterial({ color: 0x0a1a0a });
        floor = new THREE.Mesh(groundGeo, groundMat);
        floor.rotation.x = -Math.PI / 2;
        scene.add(floor);

        // --- CONSTRUCCI√ìN DE LOBO REALISTA (Formas Curvas) ---
        wolf = new THREE.Group();
        const furMat = new THREE.MeshStandardMaterial({ color: 0x333333, roughness: 0.8 });
        
        // Cuerpo elipsoide
        const body = new THREE.Mesh(new THREE.SphereGeometry(0.7, 16, 16), furMat);
        body.scale.set(1, 0.8, 1.8);
        wolf.add(body);

        // Cabeza estilizada
        const head = new THREE.Mesh(new THREE.SphereGeometry(0.5, 12, 12), furMat);
        head.position.set(0, 0.4, 1.2);
        head.scale.set(0.9, 0.8, 1.1);
        wolf.add(head);

        // Hocico
        const snout = new THREE.Mesh(new THREE.CylinderGeometry(0.15, 0.25, 0.6), furMat);
        snout.rotation.x = Math.PI/2;
        snout.position.set(0, 0.3, 1.7);
        wolf.add(snout);

        // Patas
        const legGeo = new THREE.CylinderGeometry(0.1, 0.08, 1);
        for(let i=0; i<4; i++) {
            const leg = new THREE.Mesh(legGeo, furMat);
            leg.position.set(i%2?0.3:-0.3, -0.4, i<2?0.7:-0.7);
            wolf.add(leg);
        }

        wolf.position.y = 1;
        scene.add(wolf);

        // Bosque denso
        for(let i=0; i<200; i++) spawnTree();
        spawnPrey();
        
        animate();
    }

    function spawnTree() {
        const x = Math.random()*200-100;
        const z = Math.random()*200-100;
        const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.2, 0.4, 5), new THREE.MeshStandardMaterial({color: 0x1a0d00}));
        trunk.position.set(x, 2.5, z);
        const foliage = new THREE.Mesh(new THREE.SphereGeometry(2, 8, 8), new THREE.MeshStandardMaterial({color: 0x051a05}));
        foliage.position.set(x, 6, z);
        scene.add(trunk, foliage);
    }

    function spawnPrey() {
        const mat = new THREE.MeshStandardMaterial({ color: 0x884422 });
        for(let i=0; i<20; i++) {
            const p = new THREE.Mesh(new THREE.SphereGeometry(0.4, 8, 8), mat);
            p.position.set(Math.random()*100-50, 0.4, Math.random()*100-50);
            scene.add(p);
            preys.push(p);
        }
    }

    // REGLAS DE ORBES PERSONALIZADAS
    function checkOrbs() {
        if(state.lv >= 20 || state.mapa >= 4) {
            document.getElementById('orb-alert').style.display = 'block';
            // Probabilidad equilibrada (40%) de encontrar orbe al cazar
            if(Math.random() < 0.4) {
                state.orbes++;
                document.getElementById('orb-num').innerText = state.orbes;
                if(state.orbes === 10) tg.showAlert("¬°CONCEDIDO! Deseo √âpico (10 Orbes)");
                if(state.orbes === 60) tg.showAlert("¬°LEYENDA ALCANZADA! Deseo M√°ximo (60 Orbes)");
            }
        }
    }

    // Controles
    const b = document.getElementById('joy-b');
    const s = document.getElementById('joy-s');
    b.addEventListener('touchmove', e => {
        const r = b.getBoundingClientRect();
        const x = e.touches[0].clientX - (r.left + 55);
        const y = e.touches[0].clientY - (r.top + 55);
        const d = Math.min(Math.sqrt(x*x+y*y), 40);
        const a = Math.atan2(y, x);
        joystick.x = Math.cos(a) * (d/40);
        joystick.y = Math.sin(a) * (d/40);
        s.style.transform = `translate(${Math.cos(a)*d}px, ${Math.sin(a)*d}px)`;
    });
    b.addEventListener('touchend', () => {
        joystick.x = 0; joystick.y = 0;
        s.style.transform = 'translate(0,0)';
    });

    document.getElementById('atk').addEventListener('touchstart', () => {
        tg.HapticFeedback.impactOccurred('heavy');
        preys.forEach((p, i) => {
            if(wolf.position.distanceTo(p.position) < 4) {
                scene.remove(p);
                preys.splice(i, 1);
                state.xp += 25;
                checkOrbs();
                if(state.xp >= 100) {
                    state.lv++; state.xp = 0;
                    document.getElementById('lv').innerText = state.lv;
                }
            }
        });
        if(preys.length < 5) spawnPrey();
    });

    function animate() {
        requestAnimationFrame(animate);
        if(wolf) {
            wolf.position.x += joystick.x * 0.25;
            wolf.position.z += joystick.y * 0.25;
            if(Math.abs(joystick.x) > 0.1 || Math.abs(joystick.y) > 0.1) {
                wolf.rotation.y = -Math.atan2(joystick.y, joystick.x) + Math.PI/2;
            }
            // C√°mara suave
            camera.position.lerp(new THREE.Vector3(wolf.position.x, 8, wolf.position.z + 12), 0.1);
            camera.lookAt(wolf.position);
        }
        renderer.render(scene, camera);
    }
    init();
</script>
</body>
</html>
